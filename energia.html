<!DOCTYPE html>
<html>
<head>
  <title>Ca√≠da Libre: Transformaci√≥n Energ√©tica</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    canvas { border: 1px solid #000; margin-top: 20px; }
    input { margin: 5px; width: 120px; }
    label { display: block; margin-top: 10px; }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <h2>üåå Ceremonia de Energ√≠a en Ca√≠da Libre</h2>
  <p>Ingresa los datos iniciales del cuerpo:</p>

  <label>Altura inicial (h‚ÇÄ en m): <input type="number" id="h0"></label>
  <label>Gravedad (m/s¬≤, sugerida 9.81): <input type="number" id="g" value="9.81"></label>
  <label>Masa del cuerpo (kg, opcional): <input type="number" id="m" value="1"></label>

  <h3>üîç ¬øD√≥nde quieres consultar?</h3>
  <label>Altura intermedia (m): <input type="number" id="h1"></label>
  <label>O tiempo transcurrido (s): <input type="number" id="t"></label>

  <button onclick="resolver()">Calcular</button>

  <div id="resultado" style="margin-top:20px;"></div>
  <canvas id="dibujo" width="600" height="600"></canvas>

  <script>
    function resolver() {
      const h0 = parseFloat(document.getElementById("h0").value);
      const g = parseFloat(document.getElementById("g").value);
      const m = parseFloat(document.getElementById("m").value) || 1;
      const h1 = parseFloat(document.getElementById("h1").value);
      const t = parseFloat(document.getElementById("t").value);
      let resultado = "";

      if (!h0 || !g) {
        resultado = "<p>‚ö†Ô∏è Debes ingresar al menos la altura inicial y la gravedad.</p>";
        document.getElementById("resultado").innerHTML = resultado;
        MathJax.typeset();
        return;
      }

      let v, Ep, Ek, EM, alturaFinal;

      const EM_inicial = m * g * h0;
      resultado += `<h3>üîã Energ√≠a Mec√°nica Inicial:</h3>`;
      resultado += `<p>\\[ E_M = mgh_0 = ${m} \\cdot ${g} \\cdot ${h0} = ${EM_inicial.toFixed(2)}\\ \\text{J} \\]</p>`;

      if (h1) {
        const deltaH = h0 - h1;
        v = Math.sqrt(2 * g * deltaH);
        Ep = m * g * h1;
        Ek = m * g * deltaH;
        EM = Ek + Ep;
        alturaFinal = h1;

        resultado += `<h3>üìê C√°lculo en altura intermedia:</h3>`;
        resultado += `<p>\\[ v = \\sqrt{2gh} = \\sqrt{2 \\cdot ${g} \\cdot (${h0} - ${h1})} = ${v.toFixed(2)}\\ \\text{m/s} \\]</p>`;
        resultado += `<p>\\[ E_p = mgh = ${m} \\cdot ${g} \\cdot ${h1} = ${Ep.toFixed(2)}\\ \\text{J} \\]</p>`;
        resultado += `<p>\\[ E_k = mg(h_0 - h_1) = ${m} \\cdot ${g} \\cdot (${h0} - ${h1}) = ${Ek.toFixed(2)}\\ \\text{J} \\]</p>`;
        resultado += `<p>\\[ E_M = E_k + E_p = ${Ek.toFixed(2)} + ${Ep.toFixed(2)} = ${EM.toFixed(2)}\\ \\text{J} \\]</p>`;
      } else if (t) {
        v = g * t;
        const y = 0.5 * g * t * t;
        alturaFinal = h0 - y;
        Ek = 0.5 * m * v * v;
        Ep = m * g * alturaFinal;
        EM = Ek + Ep;

        resultado += `<h3>üìê C√°lculo despu√©s de tiempo t:</h3>`;
        resultado += `<p>\\[ v = g \\cdot t = ${g} \\cdot ${t} = ${v.toFixed(2)}\\ \\text{m/s} \\]</p>`;
        resultado += `<p>\\[ h = h_0 - \\frac{1}{2}gt^2 = ${h0} - \\frac{1}{2} \\cdot ${g} \\cdot ${t}^2 = ${alturaFinal.toFixed(2)}\\ \\text{m} \\]</p>`;
        resultado += `<p>\\[ E_k = \\frac{1}{2}mv^2 = \\frac{1}{2} \\cdot ${m} \\cdot ${v.toFixed(2)}^2 = ${Ek.toFixed(2)}\\ \\text{J} \\]</p>`;
        resultado += `<p>\\[ E_p = mgh = ${m} \\cdot ${g} \\cdot ${alturaFinal.toFixed(2)} = ${Ep.toFixed(2)}\\ \\text{J} \\]</p>`;
        resultado += `<p>\\[ E_M = E_k + E_p = ${Ek.toFixed(2)} + ${Ep.toFixed(2)} = ${EM.toFixed(2)}\\ \\text{J} \\]</p>`;
      } else {
        resultado += "<p>‚ö†Ô∏è Debes ingresar una altura intermedia o un tiempo.</p>";
        document.getElementById("resultado").innerHTML = resultado;
        MathJax.typeset();
        return;
      }

      // Cierre ritual: al llegar al piso
      const vFinal = Math.sqrt(2 * g * h0);
      const EkFinal = m * g * h0;
      resultado += `<h3>üß® Al llegar al piso:</h3>`;
      resultado += `<p>\\[ v = \\sqrt{2gh_0} = \\sqrt{2 \\cdot ${g} \\cdot ${h0}} = ${vFinal.toFixed(2)}\\ \\text{m/s} \\]</p>`;
      resultado += `<p>\\[ E_k = mgh_0 = ${m} \\cdot ${g} \\cdot ${h0} = ${EkFinal.toFixed(2)}\\ \\text{J} \\]</p>`;
      resultado += `<p>\\[ E_p = 0 \\quad \\Rightarrow \\quad E_M = E_k = ${EkFinal.toFixed(2)}\\ \\text{J} \\]</p>`;

      document.getElementById("resultado").innerHTML = resultado;
      MathJax.typeset();

      // Dibujo con escala din√°mica
      const canvas = document.getElementById("dibujo");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const canvasHeight = canvas.height;
      const margenSuperior = 50;
      const margenInferior = 50;
      const espacioDisponible = canvasHeight - margenSuperior - margenInferior;
      const escala = espacioDisponible / h0;

      const baseX = 100;
      const baseY = canvasHeight - margenInferior;
      const h0Pix = h0 * escala;
      const h1Pix = alturaFinal * escala;

      // L√≠nea de ca√≠da
      ctx.beginPath();
      ctx.moveTo(baseX, baseY);
      ctx.lineTo(baseX, baseY - h0Pix);
      ctx.stroke();

      // Cuerpo inicial
      ctx.beginPath();
      ctx.arc(baseX, baseY - h0Pix, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "blue";
      ctx.fill();

      // Cuerpo intermedio
      ctx.beginPath();
      ctx.arc(baseX, baseY - h1Pix, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "red";
      ctx.fill();

            // Cuerpo al llegar al piso
      ctx.beginPath();
      ctx.arc(baseX, baseY, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "green";
      ctx.fill();

      // Etiquetas en altura inicial
      ctx.fillStyle = "black";
      ctx.fillText(`Inicio`, baseX - 40, baseY - h0Pix - 60);
      ctx.fillText(`h‚ÇÄ = ${h0.toFixed(2)} m`, baseX + 20, baseY - h0Pix - 45);
      ctx.fillText(`E‚Çö = ${EM_inicial.toFixed(2)} J`, baseX + 20, baseY - h0Pix - 30);
      ctx.fillText(`E‚Çñ = 0 J`, baseX + 20, baseY - h0Pix - 15);
      ctx.fillText(`E‚Çò = ${EM_inicial.toFixed(2)} J`, baseX + 20, baseY - h0Pix);

      // Etiquetas en punto intermedio
      ctx.fillText(`Intermedio`, baseX - 40, baseY - h1Pix - 60);
      ctx.fillText(`h = ${alturaFinal.toFixed(2)} m`, baseX + 20, baseY - h1Pix - 45);
      ctx.fillText(`v = ${v.toFixed(2)} m/s`, baseX + 20, baseY - h1Pix - 30);
      ctx.fillText(`E‚Çñ = ${Ek.toFixed(2)} J`, baseX + 20, baseY - h1Pix - 15);
      ctx.fillText(`E‚Çö = ${Ep.toFixed(2)} J`, baseX + 20, baseY - h1Pix);
      ctx.fillText(`E‚Çò = ${EM.toFixed(2)} J`, baseX + 20, baseY - h1Pix + 15);

      // Etiquetas al llegar al piso
      ctx.fillText(`Final`, baseX - 40, baseY + 20);
      ctx.fillText(`h = 0 m`, baseX + 20, baseY + 35);
      ctx.fillText(`v = ${vFinal.toFixed(2)} m/s`, baseX + 20, baseY + 50);
      ctx.fillText(`E‚Çñ = ${EkFinal.toFixed(2)} J`, baseX + 20, baseY + 65);
      ctx.fillText(`E‚Çö = 0 J`, baseX + 20, baseY + 80);
      ctx.fillText(`E‚Çò = ${EkFinal.toFixed(2)} J`, baseX + 20, baseY + 95);
    }
  </script>
</body>
</html>