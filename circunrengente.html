<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Circunferencia y Tangente Ritualizada</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    canvas { border: 1px solid #ccc; margin-top: 20px; }
    .resultado { font-size: 1.2em; margin-top: 15px; }
    label, input { margin: 5px 0; display: block; }
  </style>
</head>
<body>
  <h2>üåü Ceremonia de Circunferencia y Recta Tangente</h2>

  <label>Centro de la circunferencia (h,k): <input type="text" id="centro" value="2,3"></label>
  <label>Punto tangencial (x‚ÇÅ,y‚ÇÅ): <input type="text" id="punto" value="5,7"></label>
  <button onclick="calcular()">‚ú® Calcular y dibujar</button>

  <div class="resultado" id="resultado"></div>
  <canvas id="grafico" width="600" height="600"></canvas>

  <script>
    const escala = 20;
    const origenX = 300;
    const origenY = 300;

    function parsePunto(texto) {
      const [x, y] = texto.split(',').map(Number);
      return { x, y };
    }

    function mostrarResultado(html) {
      document.getElementById('resultado').innerHTML = html;
      MathJax.typeset();
    }

    function calcular() {
      const C = parsePunto(document.getElementById('centro').value);
      const P = parsePunto(document.getElementById('punto').value);

      const r = Math.sqrt((P.x - C.x) ** 2 + (P.y - C.y) ** 2);
      const ecuacionCircunferencia = `(x - ${C.x})^2 + (y - ${C.y})^2 = ${r.toFixed(2)}^2`;

      // Pendiente del radio
      const mRadio = (P.y - C.y) / (P.x - C.x);

      // Pendiente de la tangente (perpendicular al radio)
      const mTangente = -1 / mRadio;
      const bTangente = P.y - mTangente * P.x;
      const ecuacionTangente = `y = ${mTangente.toFixed(2)}x + ${bTangente.toFixed(2)}`;

      mostrarResultado(`
        <p>Distancia entre centro y punto tangencial:</p>
        \\( r = \\sqrt{(${P.x} - ${C.x})^2 + (${P.y} - ${C.y})^2} = ${r.toFixed(2)} \\)<br>
        <p>Ecuaci√≥n de la circunferencia:</p>
        \\( ${ecuacionCircunferencia} \\)<br>
        <p>Pendiente del radio:</p>
        \\( m_r = \\frac{${P.y} - ${C.y}}{${P.x} - ${C.x}} = ${mRadio.toFixed(2)} \\)<br>
        <p>Pendiente de la tangente:</p>
        \\( m_t = -\\frac{1}{${mRadio.toFixed(2)}} = ${mTangente.toFixed(2)} \\)<br>
        <p>Ecuaci√≥n de la recta tangente:</p>
        \\( y - ${P.y} = ${mTangente.toFixed(2)}(x - ${P.x}) \\Rightarrow ${ecuacionTangente} \\)
      `);

      dibujarCircunferenciaTangente(C, r, P, mTangente, bTangente);
    }

    function dibujarCircunferenciaTangente(C, r, P, m, b) {
      const canvas = document.getElementById('grafico');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ejes
      ctx.beginPath();
      ctx.moveTo(0, origenY); ctx.lineTo(600, origenY);
      ctx.moveTo(origenX, 0); ctx.lineTo(origenX, 600);
      ctx.strokeStyle = "#aaa"; ctx.lineWidth = 1; ctx.stroke();

      // Circunferencia
      ctx.beginPath();
      ctx.arc(origenX + C.x * escala, origenY - C.y * escala, r * escala, 0, 2 * Math.PI);
      ctx.strokeStyle = "blue"; ctx.lineWidth = 2; ctx.stroke();

      // Recta tangente
      ctx.beginPath();
      for (let x = -15; x <= 15; x++) {
        const px = origenX + x * escala;
        const py = origenY - (m * x + b) * escala;
        if (x === -15) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.strokeStyle = "green"; ctx.lineWidth = 2; ctx.setLineDash([5, 5]); ctx.stroke();
      ctx.setLineDash([]);

      // Punto tangencial
      const px = origenX + P.x * escala;
      const py = origenY - P.y * escala;
      ctx.beginPath();
      ctx.arc(px, py, 4, 0, 2 * Math.PI);
      ctx.fillStyle = "red"; ctx.fill();
      ctx.fillStyle = "black"; ctx.font = "12px Arial";
      ctx.fillText(`P (${P.x}, ${P.y})`, px + 6, py - 6);

      // Centro
      const cx = origenX + C.x * escala;
      const cy = origenY - C.y * escala;
      ctx.beginPath();
      ctx.arc(cx, cy, 4, 0, 2 * Math.PI);
      ctx.fillStyle = "orange"; ctx.fill();
      ctx.fillText(`C (${C.x}, ${C.y})`, cx + 6, cy - 6);
    }
  </script>
</body>
</html>