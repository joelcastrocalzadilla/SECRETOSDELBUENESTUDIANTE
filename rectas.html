<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Rectas Ritualizadas</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    canvas { border: 1px solid #ccc; margin-top: 20px; }
    .resultado { font-size: 1.2em; margin-top: 15px; }
    label, input, select { margin: 5px 0; display: block; }
  </style>
</head>
<body>
  <h2>üåü Ceremonia de Rectas: Paralelas y Perpendiculares</h2>

  <p>Selecciona el tipo de c√°lculo:</p>
  <select id="tipoCalculo" onchange="mostrarCampos()">
    <option value="paralela">Recta paralela por punto</option>
    <option value="perpendicular">Recta perpendicular por punto</option>
  </select>

  <div id="inputs"></div>
  <button onclick="calcular()">‚ú® Calcular y dibujar</button>

  <div class="resultado" id="resultado"></div>
  <canvas id="grafico" width="600" height="600"></canvas>

  <script>
    const escala = 20;
    const origenX = 300;
    const origenY = 300;

    function mostrarCampos() {
      const div = document.getElementById('inputs');
      div.innerHTML = `
        <label>Punto A (x‚ÇÅ,y‚ÇÅ): <input type="text" id="puntoA" value="0,0"></label>
        <label>Punto B (x‚ÇÇ,y‚ÇÇ): <input type="text" id="puntoB" value="4,4"></label>
        <label>Punto adicional (x‚ÇÉ,y‚ÇÉ): <input type="text" id="puntoExtra" value="0,2"></label>
      `;
    }

    mostrarCampos();

    function parsePunto(texto) {
      const [x, y] = texto.split(',').map(Number);
      return { x, y };
    }

    function mostrarResultado(html) {
      document.getElementById('resultado').innerHTML = html;
      MathJax.typeset();
    }

    function calcular() {
      const tipo = document.getElementById('tipoCalculo').value;
      const A = parsePunto(document.getElementById('puntoA').value);
      const B = parsePunto(document.getElementById('puntoB').value);
      const P = parsePunto(document.getElementById('puntoExtra').value);

      const mOriginal = (B.y - A.y) / (B.x - A.x);
      const bOriginal = A.y - mOriginal * A.x;

      let mNueva, bNueva, ecuacionNueva;

      if (tipo === 'paralela') {
        mNueva = mOriginal;
        bNueva = P.y - mNueva * P.x;
        ecuacionNueva = `y = ${mNueva.toFixed(2)}x + ${bNueva.toFixed(2)}`;
        mostrarResultado(`
          <p>F√≥rmula de la pendiente:</p>
          \\( m = \\frac{y_2 - y_1}{x_2 - x_1} \\)<br>
          <p>Sustituci√≥n:</p>
          \\( m = \\frac{${B.y} - ${A.y}}{${B.x} - ${A.x}} = ${mOriginal.toFixed(2)} \\)<br>
          <p>Recta original:</p>
          \\( y - ${A.y} = ${mOriginal.toFixed(2)}(x - ${A.x}) \\Rightarrow y = ${mOriginal.toFixed(2)}x + ${bOriginal.toFixed(2)} \\)<br>
          <p>Recta paralela por punto (${P.x}, ${P.y}):</p>
          \\( y - ${P.y} = ${mNueva.toFixed(2)}(x - ${P.x}) \\Rightarrow ${ecuacionNueva} \\)
        `);
      }

      if (tipo === 'perpendicular') {
        mNueva = -1 / mOriginal;
        bNueva = P.y - mNueva * P.x;
        ecuacionNueva = `y = ${mNueva.toFixed(2)}x + ${bNueva.toFixed(2)}`;
        mostrarResultado(`
          <p>F√≥rmula de la pendiente:</p>
          \\( m = \\frac{y_2 - y_1}{x_2 - x_1} \\)<br>
          <p>Sustituci√≥n:</p>
          \\( m = \\frac{${B.y} - ${A.y}}{${B.x} - ${A.x}} = ${mOriginal.toFixed(2)} \\)<br>
          <p>Recta original:</p>
          \\( y - ${A.y} = ${mOriginal.toFixed(2)}(x - ${A.x}) \\Rightarrow y = ${mOriginal.toFixed(2)}x + ${bOriginal.toFixed(2)} \\)<br>
          <p>Recta perpendicular por punto (${P.x}, ${P.y}):</p>
          \\( m_{\\perp} = -\\frac{1}{${mOriginal.toFixed(2)}} = ${mNueva.toFixed(2)} \\)<br>
          \\( y - ${P.y} = ${mNueva.toFixed(2)}(x - ${P.x}) \\Rightarrow ${ecuacionNueva} \\)
        `);
      }

      dibujarRectas(mOriginal, bOriginal, mNueva, bNueva, [A, B, P], tipo);
    }

    function dibujarRectas(m1, b1, m2, b2, puntos, tipo) {
      const canvas = document.getElementById('grafico');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ejes
      ctx.beginPath();
      ctx.moveTo(0, origenY); ctx.lineTo(600, origenY); // eje X
      ctx.moveTo(origenX, 0); ctx.lineTo(origenX, 600); // eje Y
      ctx.strokeStyle = "#aaa"; ctx.lineWidth = 1; ctx.stroke();

      // Recta original (azul)
      ctx.beginPath();
      for (let x = -15; x <= 15; x++) {
        const px = origenX + x * escala;
        const py = origenY - (m1 * x + b1) * escala;
        if (x === -15) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.strokeStyle = "blue"; ctx.lineWidth = 2; ctx.stroke();

      // Recta nueva (verde o p√∫rpura)
      ctx.beginPath();
      for (let x = -15; x <= 15; x++) {
        const px = origenX + x * escala;
        const py = origenY - (m2 * x + b2) * escala;
        if (x === -15) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.strokeStyle = tipo === "paralela" ? "green" : "purple";
      ctx.lineWidth = 2;
      ctx.setLineDash(tipo === "paralela" ? [5, 5] : []);
      ctx.stroke();
      ctx.setLineDash([]);

      // Puntos ritualizados
      puntos.forEach((p, i) => {
        const px = origenX + p.x * escala;
        const py = origenY - p.y * escala;

        ctx.beginPath();
        ctx.arc(px, py, 4, 0, 2 * Math.PI);
        ctx.fillStyle = "red";
        ctx.fill();

        ctx.fillStyle = "black";
        ctx.font = "12px Arial";
        const etiqueta = `P${i + 1} (${p.x}, ${p.y})`;
        ctx.fillText(etiqueta, px + 6, py - 6);
      });
    }
  </script>
  <div style="margin-top: 40px; text-align: center;">
  <button onclick="window.location.href='principal.html'" style="padding: 10px 20px; background-color: #4e342e; color: white; border: none; border-radius: 5px; font-size: 16px;">
    üö™ Salir del sistema
  </button>
</div>
</body>

</html>
