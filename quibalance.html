<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Balanceo Qu√≠mico por Iteraci√≥n</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #4e342e;
    }
    .paso {
      background-color: #fff8e1;
      border-left: 5px solid #ff6f00;
      padding: 10px;
      margin-top: 15px;
    }
    .celebracion {
      background-color: #c8e6c9;
      border-left: 5px solid #388e3c;
      padding: 10px;
      font-weight: bold;
    }
    input {
      margin: 5px;
      width: 100px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
    }
    td, th {
      border: 1px solid #ccc;
      padding: 5px;
    }
  </style>
</head>
<body>

  <h1>‚öóÔ∏è Balanceo Qu√≠mico por Iteraci√≥n</h1>
  <p>Ingresa hasta 3 reactivos y 3 productos. Cada compuesto puede tener hasta 3 elementos. Los campos vac√≠os se ignoran.</p>

  <h3>Reactivos</h3>
  <div id="reactivos">
    <div>
      <input id="r1name" placeholder="Compuesto 1">
      <input id="r1e1" placeholder="Elemento 1"><input id="r1s1" type="number" placeholder="Sub√≠ndice">
      <input id="r1e2" placeholder="Elemento 2"><input id="r1s2" type="number" placeholder="Sub√≠ndice">
      <input id="r1e3" placeholder="Elemento 3"><input id="r1s3" type="number" placeholder="Sub√≠ndice">
    </div>
    <div>
      <input id="r2name" placeholder="Compuesto 2">
      <input id="r2e1" placeholder="Elemento 1"><input id="r2s1" type="number" placeholder="Sub√≠ndice">
      <input id="r2e2" placeholder="Elemento 2"><input id="r2s2" type="number" placeholder="Sub√≠ndice">
      <input id="r2e3" placeholder="Elemento 3"><input id="r2s3" type="number" placeholder="Sub√≠ndice">
    </div>
    <div>
      <input id="r3name" placeholder="Compuesto 3">
      <input id="r3e1" placeholder="Elemento 1"><input id="r3s1" type="number" placeholder="Sub√≠ndice">
      <input id="r3e2" placeholder="Elemento 2"><input id="r3s2" type="number" placeholder="Sub√≠ndice">
      <input id="r3e3" placeholder="Elemento 3"><input id="r3s3" type="number" placeholder="Sub√≠ndice">
    </div>
  </div>

  <h3>Productos</h3>
  <div id="productos">
    <div>
      <input id="p1name" placeholder="Compuesto 1">
      <input id="p1e1" placeholder="Elemento 1"><input id="p1s1" type="number" placeholder="Sub√≠ndice">
      <input id="p1e2" placeholder="Elemento 2"><input id="p1s2" type="number" placeholder="Sub√≠ndice">
      <input id="p1e3" placeholder="Elemento 3"><input id="p1s3" type="number" placeholder="Sub√≠ndice">
    </div>
    <div>
      <input id="p2name" placeholder="Compuesto 2">
      <input id="p2e1" placeholder="Elemento 1"><input id="p2s1" type="number" placeholder="Sub√≠ndice">
      <input id="p2e2" placeholder="Elemento 2"><input id="p2s2" type="number" placeholder="Sub√≠ndice">
      <input id="p2e3" placeholder="Elemento 3"><input id="p2s3" type="number" placeholder="Sub√≠ndice">
    </div>
    <div>
      <input id="p3name" placeholder="Compuesto 3">
      <input id="p3e1" placeholder="Elemento 1"><input id="p3s1" type="number" placeholder="Sub√≠ndice">
      <input id="p3e2" placeholder="Elemento 2"><input id="p3s2" type="number" placeholder="Sub√≠ndice">
      <input id="p3e3" placeholder="Elemento 3"><input id="p3s3" type="number" placeholder="Sub√≠ndice">
    </div>
  </div>

  <button onclick="balancear()">‚ú® Balancear</button>

  <div id="resultado"></div>

  <script>
    function getCompuesto(prefix) {
      const nombre = document.getElementById(`${prefix}name`).value.trim();
      if (!nombre) return null;
      const elementos = {};
      for (let i = 1; i <= 3; i++) {
        const el = document.getElementById(`${prefix}e${i}`).value.trim();
        const sub = parseInt(document.getElementById(`${prefix}s${i}`).value);
        if (el && sub) elementos[el] = sub;
      }
      return { nombre, elementos };
    }

    function balancear() {
      const reactivos = ["r1", "r2", "r3"].map(getCompuesto).filter(c => c);
      const productos = ["p1", "p2", "p3"].map(getCompuesto).filter(c => c);

      const todos = [...reactivos, ...productos];
      const elementosSet = new Set();
      todos.forEach(c => Object.keys(c.elementos).forEach(e => elementosSet.add(e)));
      const elementos = Array.from(elementosSet);

      let html = `<div class="paso">üîç Paso 1: Ecuaci√≥n inicial<br>\\[${reactivos.map(c => c.nombre).join(" + ")} \\rightarrow ${productos.map(c => c.nombre).join(" + ")}\\]</div>`;

      let encontrado = false;
      let coefR = Array(reactivos.length).fill(1);
      let coefP = Array(productos.length).fill(1);

      for (let a1 = 1; a1 <= 10; a1++) {
        for (let a2 = 1; a2 <= 10; a2++) {
          for (let a3 = 1; a3 <= 10; a3++) {
            for (let b1 = 1; b1 <= 10; b1++) {
              for (let b2 = 1; b2 <= 10; b2++) {
                for (let b3 = 1; b3 <= 10; b3++) {
                  const coefReact = [a1, a2, a3].slice(0, reactivos.length);
                  const coefProd = [b1, b2, b3].slice(0, productos.length);
                  const totalR = {}, totalP = {};
                  elementos.forEach(el => {
                    totalR[el] = reactivos.reduce((sum, c, i) => sum + (c.elementos[el] || 0) * coefReact[i], 0);
                    totalP[el] = productos.reduce((sum, c, i) => sum + (c.elementos[el] || 0) * coefProd[i], 0);
                  });
                  const igual = elementos.every(el => totalR[el] === totalP[el]);
                  if (igual) {
                    coefR = coefReact;
                    coefP = coefProd;
                    encontrado = true;
                    break;
                  }
                }
                if (encontrado) break;
              }
              if (encontrado) break;
            }
                        if (encontrado) break;
          }
          if (encontrado) break;
        }
        if (encontrado) break;
      }

      if (encontrado) {
        const ecuacionBalanceada = [
          ...reactivos.map((c, i) => `${coefR[i] > 1 ? coefR[i] : ""}${c.nombre}`),
          "‚Üí",
          ...productos.map((c, i) => `${coefP[i] > 1 ? coefP[i] : ""}${c.nombre}`)
        ].join(" + ").replace(" + ‚Üí + ", " \\rightarrow ");

        html += `<div class="paso">üßÆ Paso 2: Ecuaci√≥n balanceada<br>\\[${ecuacionBalanceada}\\]</div>`;
        html += `<div class="paso">üìä Paso 3: Tabla enfrentada<br><table><tr><th>Elemento</th><th>Reactivos</th><th>Productos</th></tr>`;
        elementos.forEach(el => {
          const rTotal = reactivos.reduce((sum, c, i) => sum + (c.elementos[el] || 0) * coefR[i], 0);
          const pTotal = productos.reduce((sum, c, i) => sum + (c.elementos[el] || 0) * coefP[i], 0);
          html += `<tr><td>${el}</td><td>${rTotal}</td><td>${pTotal}</td></tr>`;
        });
        html += `</table></div>`;
        html += `<div class="celebracion">üéä ¬°Balance logrado! Cada √°tomo est√° en equilibrio. La ecuaci√≥n ha sido ritual√≠sticamente validada.</div>`;
      } else {
        html += `<div class="paso">‚ö†Ô∏è No se encontr√≥ balance en el rango de 1 a 10 moles. Revisa los sub√≠ndices o ampl√≠a el rango.</div>`;
      }

      document.getElementById("resultado").innerHTML = html;
      MathJax.typeset();
    }
  </script>

</body>
</html>